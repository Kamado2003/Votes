<!doctype html>
<html lang="sr">
<head>
<meta charset="utf-8">
<title>Glasanje</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body { font-family:'Poppins',sans-serif; background:linear-gradient(135deg,#fff5fb,#f2eaff); margin:0; padding:28px; color:#2a1a2b; }
.card { max-width:760px; margin:12px auto; background:#fff; border-radius:14px; padding:20px; box-shadow:0 8px 24px rgba(126,19,137,0.08); }
h1 { color:#7e1389; margin:0 0 12px; text-align:center; }
.desc { color:#6b596d; margin-bottom:16px; text-align:center; }
.song { display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid #f0e7f4; }
.song:last-child { border-bottom:none; }
.meta { max-width:70%; }
select { padding:8px; border-radius:8px; border:1px solid #e0cfe0; background:#fff; }
input { padding:10px; width:100%; border-radius:8px; border:1px solid #e0cfe0; margin-bottom:12px; }
.actions { display:flex; gap:12px; margin-top:14px; justify-content:center; }
button { background:#7e1389; color:#fff; border:none; padding:10px 16px; border-radius:10px; cursor:pointer; font-weight:600; }
.result { margin-top:12px; text-align:center; font-weight:600; }
.error { color:#cc0033; }
.ok { color:#007700; }
</style>
</head>
<body>

<div class="card">
  <h1>Glasanje</h1>
  <p class="desc">Unesi svoj nick i Å¡ifru i oceni pesme od 1 do 12 (bez 9 i 11).</p>

  <input id="username" placeholder="KorisniÄko ime">
  <input id="password" type="password" placeholder="Lozinka">

  <div id="songsContainer"></div>

  <div class="actions">
    <button id="submitBtn">PoÅ¡alji glasove</button>
  </div>

  <p id="result" class="result"></p>
</div>

<script>
const GAS_BASE = "PUT YOUR WEB APP URL HERE"; 
const ALLOWED=[1,2,3,4,5,6,7,8,10,12];

function createSelect(){
  const s=document.createElement("select");
  const none=document.createElement("option");
  none.value=""; none.text="- 0 -"; 
  s.appendChild(none);
  ALLOWED.forEach(n=>{
    const o=document.createElement("option");
    o.value=n; o.text=n;
    s.appendChild(o);
  });
  return s;
}

function loadSongs(){
  const cb="cb"+Date.now();
  window[cb]=function(res){
    const box=document.getElementById("songsContainer");
    if(!res.ok){ box.innerHTML="Glasanje je zatvoreno."; return; }

    box.innerHTML="";
    res.songs.forEach(song=>{
      const row=document.createElement("div");
      row.className="song";
      row.innerHTML=`<div class="meta"><strong>${song.name}</strong></div>`;
      const sel=createSelect();
      sel.dataset.id=song.id;
      row.appendChild(sel);
      box.appendChild(row);
    });
  };

  let s=document.createElement("script");
  s.src=GAS_BASE+"?action=load&callback="+cb;
  document.body.appendChild(s);
}

function gather(){
  const user=document.getElementById("username").value.trim();
  const pass=document.getElementById("password").value.trim();
  if(!user || !pass) return {error:"Unesi korisniÄko ime i lozinku"};

  let votes={};
  document.querySelectorAll("select").forEach(sel=>{
    votes[sel.dataset.id] = sel.value===""?0:Number(sel.value);
  });

  return {user,pass,votes};
}

document.getElementById("submitBtn").onclick=function(){
  const payload=gather();
  const out=document.getElementById("result");
  if(payload.error){ out.textContent=payload.error; out.className="error result"; return; }

  out.textContent="Å aljem...";
  const cb="cb"+Date.now();

  window[cb]=function(res){
    if(res.error){ out.textContent=res.error; out.className="error result"; }
    else{ out.textContent="Glas zabeleÅ¾en ðŸ’œ"; out.className="ok result"; }
  };

  const s=document.createElement("script");
  s.src=GAS_BASE+"?action=vote&user="+encodeURIComponent(payload.user)+
         "&pass="+encodeURIComponent(payload.pass)+
         "&votes="+encodeURIComponent(JSON.stringify(payload.votes))+
         "&callback="+cb;
  document.body.appendChild(s);
};

loadSongs();
</script>

</body>
</html>
